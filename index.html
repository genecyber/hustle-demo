<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hustle React Components Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0b0d10;
      color: #e6eef8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .header-left h1 {
      color: #4c9aff;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .header-left .subtitle {
      color: #8892a4;
      font-size: 0.875rem;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
      padding: 0 32px 32px 32px;
    }
    .loading {
      color: #8892a4;
      font-style: italic;
      padding: 20px;
      text-align: center;
    }

    /* Theme Switcher Styles */
    .theme-switcher {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px;
      background: var(--hustle-color-bg-tertiary, #1a1f25);
      border-radius: 8px;
      border: 1px solid var(--hustle-color-border-secondary, #333);
    }
    .theme-btn {
      padding: 6px 12px !important;
      border: none !important;
      border-radius: 6px !important;
      font-size: 12px !important;
      font-weight: 500;
      background: transparent !important;
      min-width: auto !important;
      min-height: auto !important;
    }
    .theme-btn:hover {
      background: var(--hustle-color-bg-hover, #252b33) !important;
      color: var(--hustle-color-text-primary, #e6eef8);
    }
    .theme-btn.active {
      background: var(--hustle-color-accent-primary, #4c9aff) !important;
      color: #fff;
    }

    /* Theme drawer trigger */
    .theme-trigger {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--hustle-color-bg-secondary, #12161b);
      border: 1px solid var(--hustle-color-border-secondary, #333);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.2s ease;
      z-index: 100;
    }
    .theme-trigger:hover {
      background: var(--hustle-color-bg-hover, #252b33);
      transform: scale(1.1);
    }

    /* Theme drawer */
    .theme-drawer {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--hustle-color-bg-secondary, #12161b);
      border: 1px solid var(--hustle-color-border-secondary, #333);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transform: translateX(-120%);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 101;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .theme-drawer.open {
      transform: translateX(0);
      opacity: 1;
    }
    .theme-drawer .theme-btn {
      width: 100%;
      text-align: left;
      padding: 8px 16px !important;
    }

    /* =========================================
       ENHANCED STYLES (use glow tokens)
       These effects apply to ALL themes
       ========================================= */

    /* Gradient border on chat card */
    .chat-container > div {
      position: relative;
      border: none !important;
    }
    .chat-container > div::before {
      content: '';
      position: absolute;
      inset: 0;
      padding: 1px;
      border-radius: 12px;
      background: linear-gradient(
        135deg,
        var(--hustle-color-accent-primary, #4c9aff),
        var(--hustle-color-accent-success, #10b981)
      );
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
      opacity: 0.6;
      transition: opacity 0.3s ease;
    }
    .chat-container > div:hover::before {
      opacity: 1;
    }

    /* Inputs transition */
    input, textarea {
      transition: all 0.2s ease;
    }

    /* Global button styles - consistent bordered icon button look */
    button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      background: var(--hustle-color-bg-tertiary, #1a1f25);
      border: 1px solid var(--hustle-color-border-secondary, #333);
      border-radius: var(--hustle-radius-lg, 8px);
      color: var(--hustle-color-text-secondary, #8892a4);
      font-size: 14px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    button:hover {
      background: var(--hustle-color-bg-hover, #252b33);
      border-color: var(--hustle-color-border-hover, #444);
      color: var(--hustle-color-text-primary, #e6eef8);
    }
    /* Icon-only buttons (square) */
    button:has(svg):not(:has(span)):not(:has(text)) {
      padding: 8px;
      min-width: 36px;
      min-height: 36px;
    }

    /* Connected button glow */
    .header-right > div:first-child {
      filter: drop-shadow(0 0 8px var(--hustle-glow-success, rgba(16, 185, 129, 0.4)));
    }

    /* Ambient glow at top */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 1200px;
      height: 500px;
      background: radial-gradient(ellipse at top, var(--hustle-glow-ambient, rgba(76, 154, 255, 0.06)) 0%, transparent 70%);
      pointer-events: none;
      z-index: -1;
    }

    /* Theme: Light */
    .theme-light {
      --hustle-color-bg-primary: #ffffff;
      --hustle-color-bg-secondary: #f8fafc;
      --hustle-color-bg-tertiary: #f1f5f9;
      --hustle-color-bg-hover: #e2e8f0;
      --hustle-color-bg-overlay: rgba(0, 0, 0, 0.5);
      --hustle-color-border-primary: #e2e8f0;
      --hustle-color-border-secondary: #cbd5e1;
      --hustle-color-border-hover: #94a3b8;
      --hustle-color-text-primary: #0f172a;
      --hustle-color-text-secondary: #475569;
      --hustle-color-text-tertiary: #94a3b8;
      --hustle-color-text-inverse: #ffffff;
      --hustle-color-accent-primary: #2563eb;
      --hustle-color-accent-primary-hover: #1d4ed8;
      --hustle-color-accent-primary-bg: rgba(37, 99, 235, 0.1);
      --hustle-color-accent-success: #059669;
      --hustle-color-accent-success-hover: #047857;
      --hustle-color-accent-success-bg: rgba(5, 150, 105, 0.1);
      --hustle-color-accent-warning: #d97706;
      --hustle-color-accent-warning-bg: rgba(217, 119, 6, 0.1);
      --hustle-color-accent-error: #dc2626;
      --hustle-color-accent-error-hover: #b91c1c;
      --hustle-color-accent-error-bg: rgba(220, 38, 38, 0.1);
      --hustle-color-msg-user: #dbeafe;
      --hustle-color-msg-assistant: #f1f5f9;
      --hustle-shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --hustle-shadow-md: 0 4px 6px rgba(0,0,0,0.07);
      --hustle-shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
      /* Glows */
      --hustle-glow-primary: rgba(37, 99, 235, 0.35);
      --hustle-glow-success: rgba(5, 150, 105, 0.35);
      --hustle-glow-error: rgba(220, 38, 38, 0.35);
      --hustle-glow-ambient: rgba(37, 99, 235, 0.04);
    }
    .theme-light body {
      background: #ffffff;
      color: #0f172a;
    }
    .theme-light .header-left h1 { color: #2563eb; }
    .theme-light .header-left .subtitle { color: #475569; }

    /* Theme: Midnight Purple */
    .theme-purple {
      --hustle-color-bg-primary: #0f0a1a;
      --hustle-color-bg-secondary: #1a1229;
      --hustle-color-bg-tertiary: #251a38;
      --hustle-color-bg-hover: #352950;
      --hustle-color-border-primary: #3d2a5c;
      --hustle-color-border-secondary: #4a3570;
      --hustle-color-border-hover: #5c4085;
      --hustle-color-text-primary: #e8e0f0;
      --hustle-color-text-secondary: #a090b8;
      --hustle-color-text-tertiary: #7a6890;
      --hustle-color-text-inverse: #ffffff;
      --hustle-color-accent-primary: #a855f7;
      --hustle-color-accent-primary-hover: #c084fc;
      --hustle-color-accent-primary-bg: rgba(168, 85, 247, 0.1);
      --hustle-color-accent-success: #a3e635;
      --hustle-color-accent-success-hover: #bef264;
      --hustle-color-accent-success-bg: rgba(163, 230, 53, 0.1);
      --hustle-color-accent-warning: #fbbf24;
      --hustle-color-accent-warning-bg: rgba(251, 191, 36, 0.1);
      --hustle-color-accent-error: #f87171;
      --hustle-color-accent-error-hover: #fca5a5;
      --hustle-color-accent-error-bg: rgba(248, 113, 113, 0.1);
      --hustle-color-msg-user: #3b1d6e;
      --hustle-color-msg-assistant: #1f1533;
      /* Glows */
      --hustle-glow-primary: rgba(168, 85, 247, 0.5);
      --hustle-glow-success: rgba(163, 230, 53, 0.4);
      --hustle-glow-error: rgba(248, 113, 113, 0.4);
      --hustle-glow-ambient: rgba(168, 85, 247, 0.1);
    }
    .theme-purple body {
      background: #0f0a1a;
      color: #e8e0f0;
    }
    .theme-purple .header-left h1 { color: #a855f7; }
    .theme-purple .header-left .subtitle { color: #a090b8; }

    /* Theme: Ocean */
    .theme-ocean {
      --hustle-color-bg-primary: #0a1628;
      --hustle-color-bg-secondary: #0f2034;
      --hustle-color-bg-tertiary: #162a42;
      --hustle-color-bg-hover: #1e3550;
      --hustle-color-border-primary: #1e4060;
      --hustle-color-border-secondary: #2a5075;
      --hustle-color-border-hover: #3a6890;
      --hustle-color-text-primary: #e0f2fe;
      --hustle-color-text-secondary: #7dd3fc;
      --hustle-color-text-tertiary: #38bdf8;
      --hustle-color-text-inverse: #ffffff;
      --hustle-color-accent-primary: #06b6d4;
      --hustle-color-accent-primary-hover: #22d3ee;
      --hustle-color-accent-primary-bg: rgba(6, 182, 212, 0.1);
      --hustle-color-accent-success: #2dd4bf;
      --hustle-color-accent-success-hover: #5eead4;
      --hustle-color-accent-success-bg: rgba(45, 212, 191, 0.1);
      --hustle-color-accent-warning: #fbbf24;
      --hustle-color-accent-warning-bg: rgba(251, 191, 36, 0.1);
      --hustle-color-accent-error: #fb7185;
      --hustle-color-accent-error-hover: #fda4af;
      --hustle-color-accent-error-bg: rgba(251, 113, 133, 0.1);
      --hustle-color-msg-user: #164e63;
      --hustle-color-msg-assistant: #0f2d3d;
      /* Glows */
      --hustle-glow-primary: rgba(6, 182, 212, 0.5);
      --hustle-glow-success: rgba(45, 212, 191, 0.4);
      --hustle-glow-error: rgba(251, 113, 133, 0.4);
      --hustle-glow-ambient: rgba(6, 182, 212, 0.1);
    }
    .theme-ocean body {
      background: #0a1628;
      color: #e0f2fe;
    }
    .theme-ocean .header-left h1 { color: #06b6d4; }
    .theme-ocean .header-left .subtitle { color: #7dd3fc; }

    /* Theme: Migrate.fun */
    .theme-migrate {
      --hustle-color-bg-primary: #08070d;
      --hustle-color-bg-secondary: #0f0e18;
      --hustle-color-bg-tertiary: #1a1726;
      --hustle-color-bg-hover: #2a2540;
      --hustle-color-border-primary: #4a3065;
      --hustle-color-border-secondary: #3d2855;
      --hustle-color-border-hover: #c026d3;
      --hustle-color-text-primary: #f5f0fa;
      --hustle-color-text-secondary: #b8a5d0;
      --hustle-color-text-tertiary: #7a6890;
      --hustle-color-text-inverse: #ffffff;
      --hustle-color-accent-primary: #e91e8c;
      --hustle-color-accent-primary-hover: #ff4da6;
      --hustle-color-accent-primary-bg: rgba(233, 30, 140, 0.2);
      --hustle-color-accent-success: #f0b429;
      --hustle-color-accent-success-hover: #ffd700;
      --hustle-color-accent-success-bg: rgba(240, 180, 41, 0.2);
      --hustle-color-accent-warning: #ff9500;
      --hustle-color-accent-warning-bg: rgba(255, 149, 0, 0.15);
      --hustle-color-accent-error: #ff4757;
      --hustle-color-accent-error-hover: #ff6b7a;
      --hustle-color-accent-error-bg: rgba(255, 71, 87, 0.15);
      --hustle-color-msg-user: #3d1a4a;
      --hustle-color-msg-assistant: #1a1428;
      /* Glows - extra vibrant for Migrate */
      --hustle-glow-primary: rgba(233, 30, 140, 0.6);
      --hustle-glow-success: rgba(240, 180, 41, 0.5);
      --hustle-glow-error: rgba(255, 71, 87, 0.5);
      --hustle-glow-ambient: rgba(233, 30, 140, 0.12);
    }
    .theme-migrate body {
      background: #08070d;
      color: #f5f0fa;
    }
    .theme-migrate .header-left h1 {
      background: linear-gradient(135deg, #e91e8c 0%, #ff6bb3 50%, #c026d3 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .theme-migrate .header-left .subtitle { color: #b8a5d0; }

    /* Migrate theme - enhanced gradient border (3 colors) */
    .theme-migrate .chat-container > div::before {
      background: linear-gradient(135deg, #e91e8c, #c026d3, #7c3aed);
      opacity: 0.8;
    }
    .theme-migrate .chat-container > div:hover::before {
      opacity: 1;
    }

    /* Migrate theme - gradient active button */
    .theme-migrate .theme-btn.active {
      background: linear-gradient(135deg, #e91e8c, #c026d3);
    }
  </style>

  <!-- Import Map for ESM modules -->
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "emblem-auth-sdk": "https://esm.sh/emblem-auth-sdk@latest",
        "hustle-incognito": "https://esm.sh/hustle-incognito@latest?bundle"
      }
    }
  </script>
</head>
<body>
  <div id="root">
    <div class="loading">Loading React components...</div>
  </div>

  <script type="module">
    import React, { createElement as h, useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';

    // Import our components
    import {
      EmblemAuthProvider,
      HustleProvider,
      ConnectButton,
      AuthStatus,
      HustleChat,
      useEmblemAuth,
    } from './dist/browser/hustle-react.js';

    // Config for dev environment
    const CONFIG = {
      appId: 'demo-app-id',
      apiUrl: 'https://dev-api.emblemvault.ai',
      modalUrl: 'https://dev-auth.emblemvault.ai/connect',
      hustleApiUrl: 'https://dev.agenthustle.ai',
    };

    // Available themes
    const THEMES = [
      { id: 'dark', label: 'Dark' },
      { id: 'light', label: 'Light' },
      { id: 'purple', label: 'Purple' },
      { id: 'ocean', label: 'Ocean' },
      { id: 'migrate', label: 'Migrate' },
    ];

    // Theme Drawer Component
    function ThemeDrawer({ theme, setTheme, isOpen, setIsOpen }) {
      return h('div', null,
        // Trigger button
        h('button', {
          className: 'theme-trigger',
          onClick: () => setIsOpen(!isOpen),
          title: 'Change theme',
        }, 'ðŸŽ¨'),
        // Drawer
        h('div', { className: `theme-drawer ${isOpen ? 'open' : ''}` },
          h('div', {
            style: {
              fontSize: '11px',
              color: 'var(--hustle-color-text-tertiary)',
              marginBottom: '4px',
              paddingLeft: '8px'
            }
          }, 'THEME'),
          THEMES.map(t =>
            h('button', {
              key: t.id,
              className: `theme-btn ${theme === t.id ? 'active' : ''}`,
              onClick: () => {
                setTheme(t.id);
                setIsOpen(false);
              },
            }, t.label)
          )
        )
      );
    }

    // Inner app component that uses auth context
    function AppContent() {
      const { isAuthenticated } = useEmblemAuth();

      return h('div', { style: { display: 'flex', flexDirection: 'column', height: '100vh' } },
        // Header
        h('div', { className: 'header' },
          h('div', { className: 'header-left' },
            h('h1', null, 'Agent Hustle SDK'),
            h('p', { className: 'subtitle' }, 'Basic customizable streaming chat demo with EmblemAuth support')
          ),
          h('div', { className: 'header-right' },
            h(ConnectButton)
          )
        ),

        // Chat Section (always shown - HustleChat handles auth state)
        h('div', { className: 'chat-container' },
          h(HustleChat, {
            showSettings: true,
            placeholder: 'Ask me anything...'
          })
        )
      );
    }

    // Main App with providers
    function App() {
      const [theme, setTheme] = useState('dark');
      const [drawerOpen, setDrawerOpen] = useState(false);

      // Apply theme class to html element
      useEffect(() => {
        const html = document.documentElement;
        // Remove all theme classes
        html.classList.remove('theme-light', 'theme-purple', 'theme-ocean', 'theme-migrate');
        // Add new theme class (dark is default, no class needed)
        if (theme !== 'dark') {
          html.classList.add(`theme-${theme}`);
        }
      }, [theme]);

      return h('div', null,
        h(EmblemAuthProvider, {
          appId: CONFIG.appId,
          apiUrl: CONFIG.apiUrl,
          modalUrl: CONFIG.modalUrl,
        },
          h(HustleProvider, {
            hustleApiUrl: CONFIG.hustleApiUrl,
          },
            h(AppContent)
          )
        ),
        // Theme drawer (outside providers, fixed position)
        h(ThemeDrawer, { theme, setTheme, isOpen: drawerOpen, setIsOpen: setDrawerOpen })
      );
    }

    // Render the app
    const root = createRoot(document.getElementById('root'));
    root.render(h(App));
  </script>
</body>
</html>
